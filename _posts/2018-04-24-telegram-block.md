---
layout: post
title:  "7 дней спустя"
date:   2018-04-24 02:36:00
comments: true
tags: [telegram, security]
---

Сугубо мое ИМХО по поводу блокировки Telegram, предположения о том, что будет дальше, а также пара мыслей о том, как и в дальнейшем обходить блокировки.

## Как происходит блокировка

### Блокировка в интернете

Началось все с того, что утром 16 апреля РКН добавил домены Telegram в список блокируемых доменов. Примерно в обед 16 апреля провайдеры начали блокировать данные домены. Блокировка осуществляется разными способами: в выгрузку попали как домены Telegram, так и ip адреса серверов, на которые отправляет запросы приложение.

В ответ на блокировку Telegram начал мигрировать на сервера облачных провайдеров(Amazon, Google). Также появились компании, предоставляющие бесплатные прокси для Telegram.

Вслед за обходом блокировок со стороны Telegram, РКН начал добавлять в блок целые подсети разных компаний и облачных провайдеров. Особо чувствительным для меня оказались Google, Amazon, Digital Ocean, Hetzner. Облачные провайдеры попали под блокировки в основном за то, что на них хостились прокси.

Ну и конечно, самым неприятным стала блокировка google.com, из-за чего не работает поиск, частично работают переводчик, youtube, recaptcha и другие сервисы Google.

### Блокировка публичных прокси

На следующий день после начала блокировок, компаниям предоставляющим SOCKS5 прокси были разосланы письма с требованием закрыть доступ к прокси.

### Удаление приложения в магазинах

Самое нежелательное развитие событий: пользователям будет трудно или невозможно обновить приложение. РКН направил требование удалить Telegram из российских AppStore и Google Play семнадцатого апреля, на следующий день после начала блокировок. Наиболее известным приложением, удаленным из магазинов приложений по просьбе РКН на даныый момент является LinkedIn, до сих пор недоступный в AppStore.

## Обход блокировок

### Proxy

Еще до начала блокировок, компании [VeeSecurity](https://veesecurity.com) и [TgVPN](https://t.me/tgvpnbot) объявили о бесплатных SOCKS5 прокси.

Многие пользователи разворачивают свои SOCKS5 прокси на зарубежных серверах, однако на данный момент сделать это довольно сложно, так как многие крупные хостинг провайдеры уже заблокированы. Так же есть сообщения, что FastVPS останавливает службы прокси(убивает демон sockd?) на своих VPS. Если же есть возможность развернуть свой прокси, то вот тут(https://github.com/schors/tgdante) есть Docker образ Dante, настроенй специально для телеграм.

Другим способом обойти блокировки является VPN. В отличии от SOCKS прокси, VPN гонит через себя весь трафик, а не только данные Telegram. Таким образом если пропускная способность VPN канала маленькая, тормозить будут все приложения, работающие с сетью.

В AppStore и Google Play можно найти кучу приложений, предоставляющих относительно бесплатный доступ к VPN. Крайне не рекомендуется пользоваться данными сервисами для чего-то кроме экстренного доступа к Telegram, так как если сервис бесплатный, то товаром становитесь вы сами.

Можно воспользоваться платным VPN, благо цена на них вполне адекватная и соизмерима с ценой VPS. Наиболее известным и считающимся надежным является [NordVPN](https://nordvpn.com).

Ну и наконец при настройке собственного VPN придется столкнуться с той же сложностью, что и с SOCKS: сложно найти незаблокированный VPS. Для себя я выбрал OpenVPN, мануал для настройки которого можно найти на сайте [Digital Ocean](https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04). Пара хинтов: стоит поставить TCP и 443 порт, чтоб провайдеру было сложнее выявить ипользование VPN. Желательно сделать образ VPS с настроенным OpenVPN а также в конфигурации указать домен, а не конкретный ip с инстансом OpenVPN, чтоб в случае блокировки ip адреса VPS можно было легче мигрировать на другую VPS, развернув новый инстанс из образа и поменяв A(AAAA) запись в DNS.

### Telegram

После начала блокировки, Telegram анонсировал обход блокировок внутри приложения и вскоре это действительно заработало. Telegram просто посылает на телефон push уведомление c сервисным сообщением, в котором указан новый ip и домен для соединения. Таким образом Telegram может менять адреса, пока у него будут в запасе новые серверы с незаблокированными ip.

### Удаление из магазинов приложений

В данном случае тяжелее всего придется пользователям iOS: установка приложений не из магазина довольно сложна. Пользователи Android могут скачать .apk файл и установить его. в iOS тоже есть аналог .apk: .ipa(iPhone Application). Это собранные разработчиками образы приложения, подписанные подписью разработчика. Такие образы можно установить на iOS устройство [через iTunes](https://stackoverflow.com/questions/26720764/install-ipa-with-itunes-12#26904969). На данный момент скачать .ipa Telegram можно в канале [Telegram Beta](https://t.me/tgbeta), однако неизвестно, как долго можно будет пользоваться этим методом: Apple запрещает распространять подписанные .ipa вне AppStore. Так что если Telegram выберет данный способ установки приложения на устройство, Apple может отозвать подпись.

## P.S.

Нелегкое время наступило для российского сегмента интернета. Пользователи не могут в полной мере пользоваться интернет сервисами. Компании несут убытки из-за неработоспособности многих ключевых облачных сервисов. А машина блокировок и не думает останавлиаться.
